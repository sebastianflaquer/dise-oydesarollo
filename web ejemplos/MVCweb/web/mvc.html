<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>VISTA WEB </title>
    </head>
    
    <body>
        
        <script src="http://code.jquery.com/jquery-latest.min.js">
            //Biblioteca jquery para enviar peticiones a la vista en el servidor
        </script>
        <script type="text/javascript">
            
            //Abro conexion SSE indicando al servlet crear una nueva vista
            var vistaWeb = new EventSource("VistaDatoServlet?accion=new");
                                    
            vistaWeb.onerror = function(evento) {
               alert("Sin conexion con el servidor");
               vistaWeb.close();
            };
            //Registro SSE para eventos de tipo "dato"
            vistaWeb.addEventListener("dato", function (evento){
               var mensajes = document.getElementById("mensajes");
                var contenido = mensajes.innerHTML + evento.data;
                mensajes.innerHTML = contenido;
            },false);
            //Registro SSE para eventos de tipo "conectados"
            vistaWeb.addEventListener("conectados", function (evento){
               document.getElementById("conectados").innerHTML = evento.data;
            },false);
            //Capturo evento de cierre de la ventana o tab
            window.addEventListener("beforeunload", function (e) {
                desconectar();
            });
        
            //Funciones jquery para enviar peticiones al objeto VistaDatoWeb via el servlet
            //El resultado del get (que se obtiene con d.data dentro de la funcion) 
            //es vacio por que el resultado de la peticion se envia por SSE
            //No uso forms html por que sino tendr√±ia que volver a generar toda la pagina en lugar de solo generar lo que quiero actualizar
            function conectar() {
                $.get("VistaDatoServlet?accion=conectar", function (d) { 
                    
                });
            };
            function desconectar() {
                $.get("VistaDatoServlet?accion=desconectar", function (d) { 
                });
            };
            function enviar() {
                var dato = document.getElementById("contenido").value;
                $.get("VistaDatoServlet?accion=enviar&dato="+dato , function (d) { 
                });
            };
    
        </script>
        
        <span id="mensajes"></span>
        <br><br>
        <input size="58" id="contenido">
        <button onclick="enviar()"> Enviar</button>
        <br><br>
        <button onclick="conectar()"> Conectar</button>
        <button onclick="desconectar()"> Desconectar</button>
        <br><br>
        <span id="conectados"></span>
    </body>
</html>